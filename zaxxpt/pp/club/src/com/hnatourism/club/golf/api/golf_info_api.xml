<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="golfInfoApi">
	<typeAlias alias="golfInfoVo" type="com.hnatourism.club.golf.prod.vo.GolfInfoVo" />
	
	
	<resultMap id="golfInfoResultMap" class="golfInfoVo">
		<result column="PATTERN" property="pattern" />
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result column="CITY" property="city" />
		<result column="DESIGNER" property="designer" />
		<result column="SETUP_TIME" property="setupTime" />
		<result column="STADIUM_AREA" property="stadiumArea" />
		<result column="FAIRWAY_LENGTH" property="fairwayLength" />
		<result column="GREEN_GRASS" property="greenGrass" />
		<result column="FAIRWAY_GRASS" property="fairwayGrass" />
		<result column="COURSE_DATA" property="courseData" />
		<result column="COURSE_DESCRIPTION" property="courseDescription" />
		<result column="FACILITY_INFORMATION" property="facilityInformation" />
		<result column="STS" property="sts" />
		<result column="CREATE_USER" property="createUser" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="UPDATE_USER" property="updateUser" />
		<result column="UPDATE_TIME" property="updateTime" />
		<result column="ORGANIZATION_ID" property="organizationId" />
		<result column="ADDRESS" property="address" />
		<result column="REFERENCELINE" property="referenceLine" />
	</resultMap>
	
	<resultMap id="api_golfInfoResultMap" class="golfInfoVo">
		<result column="PATTERN" property="pattern" />
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result column="CITY" property="city" />
		<result column="DESIGNER" property="designer" />
		<result column="SETUP_TIME" property="setupTime" />
		<result column="STADIUM_AREA" property="stadiumArea" />
		<result column="FAIRWAY_LENGTH" property="fairwayLength" />
		<result column="GREEN_GRASS" property="greenGrass" />
		<result column="FAIRWAY_GRASS" property="fairwayGrass" />
		<result column="COURSE_DATA" property="courseData" />
		<result column="COURSE_DESCRIPTION" property="courseDescription" />
		<result column="FACILITY_INFORMATION" property="facilityInformation" />
		<result column="STS" property="sts" />
		<result column="CREATE_USER" property="createUser" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="UPDATE_USER" property="updateUser" />
		<result column="UPDATE_TIME" property="updateTime" />
		<result column="ADDRESS" property="address" />
		<result column="REFERENCELINE" property="referenceLine" />
		<result property="golfsitelist"   column="ID"  select="api_findGolfSiteByGolf_search" />
		<result property="golfiamgelist"   column="ID"  select="api_findGolfListImg" />
		<result property="golfimage"   column="ID"  select="api_findGolfImg" />
		<result property="sysConstantVo"   column="STS"  select="api_findsysConstant_golfStatus" />
		<result property="sysContactList"   column="ID"  select="findSysContactByGolf" />
	</resultMap>
	
	<resultMap id="api_golfInfoResultMap_search" class="golfInfoVo">
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result column="CITY" property="city" />
		<result column="STS" property="sts" />
		<result property="golfsitelist"   column="ID"  select="api_findGolfSiteByGolf_search" />
		<result property="sysConstantVo"   column="STS"  select="api_findsysConstant_golfStatus" />
		<result property="cityVo"   column="city"  select="api_findHnaProCityById" />
	</resultMap>
	
	<resultMap id="api_golfInfoResultMap_COMMPro" class="golfInfoVo">
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result property="cityVo"   column="city"  select="api_findHnaProCityById" />
		<result property="golfimage"   column="ID"  select="api_findGolfImg" />
		<result property="golfsitelist"   column="ID"  select="api_findGolfSiteByGolf_search" />
		<result property="minPrice"   column="ID"  select="api_findMinSitePriceByGolf" />
		<result property="minHPrice"   column="ID"  select="api_findMinSiteHPriceByGolf" />
	</resultMap>
	
	<resultMap id="api_golfInfoResultMap_COMMCITY" class="golfInfoVo">
		<result column="ID" property="id" />
		<result column="NAME" property="name" />
		<result property="golfsitelist"   column="ID"  select="api_findGolfSiteByGolf_search" />
		<result property="minPrice"   column="ID"  select="api_findMinSitePriceByGolf" />
		<result property="minHPrice"   column="ID"  select="api_findMinSiteHPriceByGolf" />
	</resultMap>
	
	<parameterMap class="java.util.HashMap" id="parameterMap">   
      <parameter property="id"/>   
    </parameterMap> 
	<sql id="api_selectGolfInfoSql">
		<![CDATA[
			SELECT T.ADDRESS,T.REFERENCELINE,T.PATTERN,T.ID,T.NAME,T.CITY,T.DESIGNER,T.SETUP_TIME,T.STADIUM_AREA,T.FAIRWAY_LENGTH,T.GREEN_GRASS,T.FAIRWAY_GRASS,T.COURSE_DATA,T.COURSE_DESCRIPTION,T.FACILITY_INFORMATION,T.STS,T.CREATE_USER,T.CREATE_TIME,T.UPDATE_USER,T.UPDATE_TIME,T.ORGANIZATION_ID 
			FROM GOLF_INFO T
		]]>
	</sql>
	<sql id="api_selectGolfInfoSql_search">
		<![CDATA[
			SELECT T.ID,T.NAME,T.CITY,T.STS 
			FROM GOLF_INFO T
		]]>
	</sql>
	
	<select id="api_findGolfInfoByWhere" parameterClass="java.util.HashMap" resultMap="api_golfInfoResultMap">
		<include refid="api_selectGolfInfoSql"/>	
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				T.ID in (#id#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="pattern">
				T.PATTERN=#pattern#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="name">
				T.NAME like %'#name#'%
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="city">
				T.CITY=#city#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="designer">
				T.DESIGNER=#designer#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="setupTime">
				T.SETUP_TIME=#setupTime#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="stadiumArea">
				T.STADIUM_AREA=#stadiumArea#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fairwayLength">
				T.FAIRWAY_LENGTH=#fairwayLength#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="greenGrass">
				T.GREEN_GRASS=#greenGrass#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="fairwayGrass">
				T.FAIRWAY_GRASS=#fairwayGrass#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="courseData">
				T.COURSE_DATA=#courseData#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="courseDescription">
				T.COURSE_DESCRIPTION=#courseDescription#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="facilityInformation">
				T.FACILITY_INFORMATION=#facilityInformation#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="sts">
				T.STS=#sts#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="createUser">
				T.CREATE_USER=#createUser#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="createTime">
				T.CREATE_TIME=#createTime#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="updateUser">
				T.UPDATE_USER=#updateUser#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="updateTime">
				T.UPDATE_TIME=#updateTime#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="organizationId">
				T.ORGANIZATION_ID=#organizationId#
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="api_findGolfInfoById" parameterClass="java.lang.String" resultMap="api_golfInfoResultMap">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.ID=#id#
		]]>
	</select>

	<select id="api_findGolfInfoById_hm" parameterClass="java.util.HashMap" resultMap="api_golfInfoResultMap">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.ID=#id#
		]]>
	</select>
	<select id="api_findGolfInfoByRecomProd" parameterClass="java.lang.String" resultMap="api_golfInfoResultMap_COMMCITY">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.CITY =#pccode# and T.ID in (select R.PROD_CODE from (select p.prod_code from RECOMMEND_PROD p where p.PROD_TYPE='GF' and p.STS=1 order by p.SEQ) R) and t.sts=1
		]]>
	</select>
	<select id="api_findGolfInfoByRecommendProd" parameterClass="java.lang.String" resultMap="api_golfInfoResultMap_COMMPro">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.ID in (select R.PROD_CODE from (select p.prod_code from RECOMMEND_PROD p where p.PROD_TYPE='GF' and p.STS=1 order by p.SEQ) R) and t.sts=1
		]]>
	</select>
	<parameterMap class="java.util.HashMap" id="findGolfInfoBySearchPM">   
      <parameter property="id"/>  
       <parameter property="name"/>  
       <parameter property="city" jdbcType="String"/> 
       <parameter property="type"/>
    </parameterMap> 
	<select id="api_findGolfInfoBySearch" parameterMap="findGolfInfoBySearchPM" resultMap="api_golfInfoResultMap_search">
		<include refid="api_selectGolfInfoSql"/>
		<dynamic prepend="WHERE">
			<isNotEmpty prepend="AND" property="id">
				T.ID=#id#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="city">
				T.CITY=#city#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="type">
				T.ID IN (SELECT S.GOLF_ID FROM GOLF_SITE S WHERE S.TYPE=#type#)
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="name">
				T.NAME like '%$name$%'
			</isNotEmpty>
		</dynamic> 
		<![CDATA[
			AND T.ID IN (SELECT S.GOLF_ID FROM GOLF_SITE S WHERE S.ID IN (SELECT P.SITE_ID FROM GOLF_PRICE P WHERE P.END_TIME>=to_date(#bookTime#,'yyyy-mm-dd') AND  P.start_TIME<=to_date(#bookTime#,'yyyy-mm-dd') AND P.STS<>0)) ORDER BY T.STS DESC
		]]>
	</select>
	
	<insert id="api_saveGolfInfo" parameterClass="golfInfoVo">
		INSERT INTO GOLF_INFO
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="pattern">
				PATTERN
			</isNotEmpty>
			
			<isNotEmpty prepend="," property="id">
				ID
			</isNotEmpty>

			<isNotEmpty prepend="," property="name">
				NAME
			</isNotEmpty>

			<isNotEmpty prepend="," property="city">
				CITY
			</isNotEmpty>

			<isNotEmpty prepend="," property="designer">
				DESIGNER
			</isNotEmpty>

			<isNotEmpty prepend="," property="setupTime">
				SETUP_TIME
			</isNotEmpty>

			<isNotEmpty prepend="," property="stadiumArea">
				STADIUM_AREA
			</isNotEmpty>

			<isNotEmpty prepend="," property="fairwayLength">
				FAIRWAY_LENGTH
			</isNotEmpty>

			<isNotEmpty prepend="," property="greenGrass">
				GREEN_GRASS
			</isNotEmpty>

			<isNotEmpty prepend="," property="fairwayGrass">
				FAIRWAY_GRASS
			</isNotEmpty>

			<isNotEmpty prepend="," property="courseData">
				COURSE_DATA
			</isNotEmpty>

			<isNotEmpty prepend="," property="courseDescription">
				COURSE_DESCRIPTION
			</isNotEmpty>

			<isNotEmpty prepend="," property="facilityInformation">
				FACILITY_INFORMATION
			</isNotEmpty>

			<isNotEmpty prepend="," property="sts">
				STS
			</isNotEmpty>

			<isNotEmpty prepend="," property="createUser">
				CREATE_USER
			</isNotEmpty>

			<isNotEmpty prepend="," property="createTime">
				CREATE_TIME
			</isNotEmpty>

			<isNotEmpty prepend="," property="updateUser">
				UPDATE_USER
			</isNotEmpty>

			<isNotEmpty prepend="," property="updateTime">
				UPDATE_TIME
			</isNotEmpty>
			<isNotEmpty prepend="," property="organizationId">
				ORGANIZATION_ID
			</isNotEmpty>

		</dynamic>		
		<dynamic prepend=") VALUES (">
			
			
			<isNotEmpty prepend="," property="pattern">
				#pattern#
			</isNotEmpty>
			
			
			<isNotEmpty prepend="," property="id">
				#id#
			</isNotEmpty>


			<isNotEmpty prepend="," property="name">
				#name#
			</isNotEmpty>


			<isNotEmpty prepend="," property="city">
				#city#
			</isNotEmpty>


			<isNotEmpty prepend="," property="designer">
				#designer#
			</isNotEmpty>


			<isNotEmpty prepend="," property="setupTime">
				#setupTime#
			</isNotEmpty>


			<isNotEmpty prepend="," property="stadiumArea">
				#stadiumArea#
			</isNotEmpty>


			<isNotEmpty prepend="," property="fairwayLength">
				#fairwayLength#
			</isNotEmpty>


			<isNotEmpty prepend="," property="greenGrass">
				#greenGrass#
			</isNotEmpty>


			<isNotEmpty prepend="," property="fairwayGrass">
				#fairwayGrass#
			</isNotEmpty>


			<isNotEmpty prepend="," property="courseData">
				#courseData#
			</isNotEmpty>


			<isNotEmpty prepend="," property="courseDescription">
				#courseDescription#
			</isNotEmpty>


			<isNotEmpty prepend="," property="facilityInformation">
				#facilityInformation#
			</isNotEmpty>


			<isNotEmpty prepend="," property="sts">
				#sts#
			</isNotEmpty>


			<isNotEmpty prepend="," property="createUser">
				#createUser#
			</isNotEmpty>


			<isNotEmpty prepend="," property="createTime">
				#createTime#
			</isNotEmpty>


			<isNotEmpty prepend="," property="updateUser">
				#updateUser#
			</isNotEmpty>


			<isNotEmpty prepend="," property="updateTime">
				#updateTime#
			</isNotEmpty>


			<isNotEmpty prepend="," property="organizationId">
				#organizationId#
			</isNotEmpty>

		 </dynamic>	)
	</insert>

	
	<select id="f_golf_img_ById" parameterMap="parameterMap" resultMap="api_golfInfoResultMap">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.ID=?
		]]>
	</select>
	<!-- 根据场地id查找高尔夫  传入参数为String  谷建亮 -->
	<select id="api_findGolfBySiteId_Str" parameterClass="java.lang.String" resultMap="golfInfoResultMap">
		<include refid="api_selectGolfInfoSql"/>	
		<![CDATA[
			WHERE T.ID=(SELECT S.GOLF_ID FROM GOLF_SITE S WHERE S.ID=#id#) AND T.STS=1
		]]>
	</select>
	
</sqlMap>