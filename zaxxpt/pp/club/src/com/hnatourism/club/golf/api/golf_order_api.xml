<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="golfOrderApi">
		<typeAlias alias="golfOrderVo" type="com.hnatourism.club.golf.order.vo.GolfOrderVo" />
	<resultMap id="api_golfOrderResultMap" class="golfOrderVo">
			<result column="CONFIRM_TIME" property="confirmTime" />
		<result column="STS" property="sts" />
		<result column="TOTAL_BALL" property="totalBall" />
		<result column="PRICE" property="price" />
		<result column="ADDITIONAL_FEE" property="additionalFee" />
		<result column="AMOUNT_PRICE" property="amountPrice" />
		<result column="PAY_STS" property="paySts" />
		<result column="CONSUMER_STS" property="consumerSts" />
		<result column="SOURCE" property="source" />
		<result column="RMK" property="rmk" />
		<result column="CODE" property="code" />
		<result column="OPERATE_STS" property="operateSts" />
		<result column="CREATE_USER" property="createUser" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="UPDATE_USER" property="updateUser" />
		<result column="UPDATE_TIME" property="updateTime" />
		<result column="ID" property="id" />
		<result column="SITE_ID" property="siteId" />
		<result column="MEMBER_CODE" property="memberCode" />
		<result column="COUNT" property="count" />
		<result column="BOOK_TIME" property="bookTime" />
		<result column="BILL_ID" property="billId" />
		<result column="PROFIT" property="profit" />
		<result column="PROFIT_AMOUNT" property="profitAmount" />
		<result column="SIGNING_PRICE" property="signPrice" />
 		<result column="SITE_ID" property="golfSiteVo" select="api_findSiteById_order"/>
 		<result column="SITE_ID" property="golfInfoVo" select="api_findGolfBySiteId_Str"/>
 		<result column="ID" property="golfOrderPlayVoList" select="api_findOrderGlofPlayerById"/>
		<result column="ID" property="golfPriceVo"  select="api_findSitePriceByOrderId"/>
		<result column="ID" property="golfOrderLogVoList" select="api_findOrderLogByOrderId_1"/>
		<result column="ID" property="orderContactVo" select="api_findContactByOrderId"/>
		<result column="ID" property="golfOrderExceptionList" select="api_findGolfOrderExcep"/>
	</resultMap>
	<sql id="api_selectGolfOrderSql">
		<![CDATA[
			SELECT T.PROFIT,T.PROFIT_AMOUNT,T.SIGNING_PRICE,T.CONFIRM_TIME,T.CODE,T.STS,T.TOTAL_BALL,T.PRICE,T.ADDITIONAL_FEE,T.AMOUNT_PRICE,T.PAY_STS,T.CONSUMER_STS,T.OPERATE_STS,T.SOURCE,T.RMK,T.CREATE_USER,T.CREATE_TIME,T.UPDATE_USER,T.UPDATE_TIME,T.ID,T.SITE_ID,T.MEMBER_CODE,T.COUNT,T.BOOK_TIME,T.BILL_ID 
			FROM ORDER_GLOF T 
		]]>
	</sql>
	<!-- 查找全部 -->
	<parameterMap class="java.util.HashMap" id="memberMap">   
      <parameter property="memberCode"/>
    </parameterMap>
    
    <resultMap id="api_findAllOrderResultMap" class="golfOrderVo">
			<result column="CONFIRM_TIME" property="confirmTime" />
		<result column="STS" property="sts" />
		<result column="TOTAL_BALL" property="totalBall" />
		<result column="PRICE" property="price" />
		<result column="ADDITIONAL_FEE" property="additionalFee" />
		<result column="AMOUNT_PRICE" property="amountPrice" />
		<result column="PAY_STS" property="paySts" />
		<result column="CONSUMER_STS" property="consumerSts" />
		<result column="SOURCE" property="source" />
		<result column="RMK" property="rmk" />
		<result column="CODE" property="code" />
		<result column="OPERATE_STS" property="operateSts" />
		<result column="CREATE_USER" property="createUser" />
		<result column="CREATE_TIME" property="createTime" />
		<result column="UPDATE_USER" property="updateUser" />
		<result column="UPDATE_TIME" property="updateTime" />
		<result column="ID" property="id" />
		<result column="SITE_ID" property="siteId" />
		<result column="MEMBER_CODE" property="memberCode" />
		<result column="COUNT" property="count" />
		<result column="BOOK_TIME" property="bookTime" />
		<result column="BILL_ID" property="billId" />
		<result column="PROFIT" property="profit" />
		<result column="PROFIT_AMOUNT" property="profitAmount" />
		<result column="SIGNING_PRICE" property="signPrice" />
 		<result column="SITE_ID" property="golfSiteVo" select="api_findSiteById_order"/>
 		<result column="SITE_ID" property="golfInfoVo" select="api_findGolfBySiteId_Str"/>
		
	</resultMap>
	<select id="api_findAllOrder" parameterMap="memberMap" resultMap="api_findAllOrderResultMap">
		<include refid="api_selectGolfOrderSql"/>
		<![CDATA[
			WHERE T.MEMBER_CODE=? ORDER BY T.CREATE_TIME DESC
		]]>
	</select>
	
	<!-- 根据id查找订单 -->
	<select id="findGolfOrderVoById" parameterClass="java.lang.String" resultMap="api_findAllOrderResultMap">
		<include refid="api_selectGolfOrderSql"/>	
		<![CDATA[
			WHERE T.ID=#id#
		]]>
	</select>
	
	<parameterMap class="java.util.HashMap" id="parameterMap">   
      <parameter property="id"/>
    </parameterMap>
	<parameterMap class="java.util.HashMap" id="billMap">
      <parameter property="billId"/>
    </parameterMap>
	<select id="api_findGolfOrderById" parameterMap="parameterMap" resultMap="api_golfOrderResultMap">
		<include refid="api_selectGolfOrderSql"/>	
		<![CDATA[
			WHERE T.ID=?
		]]>
	</select>
	<select id="api_findGolfOrderByBill" parameterMap="billMap" resultMap="api_golfOrderResultMap">
		<include refid="api_selectGolfOrderSql"/>	
		<![CDATA[
			WHERE T.BILL_ID=?
		]]>
	</select>
    <parameterMap class="java.util.HashMap" id="updateparameterMap">   
      <parameter property="id"/>  
      <parameter property="sts"/> 
      <parameter property="updateUser"/>
      <parameter property="updateTime"/>
    </parameterMap>
	 <update id="modifyGlofOrder" parameterMap="updateparameterMap" >
		UPDATE ORDER_GLOF 
        <dynamic prepend="set">
		   <isNotEmpty prepend="," property="sts">
              STS=#sts#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateUser">
              UPDATE_USER=#updateUser#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateTime">
              UPDATE_TIME=#updateTime#
           </isNotEmpty>
        </dynamic>

		WHERE      ID=#id#
	</update>
	<!-- 更改异常订单状态 -->
	<update id="modifyGlofOrderExp" parameterMap="updateparameterMap" >
		UPDATE ORDER_GOLF_EXCEPTION 
        <dynamic prepend="set">
		   <isNotEmpty prepend="," property="sts">
              STS=#sts#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateUser">
              UPDATE_USER=#updateUser#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateTime">
              UPDATE_TIME=#updateTime#
           </isNotEmpty>
        </dynamic>
		WHERE      ID=#id#
	</update>
	
	<!--订单取消  -->
	<update id="modifyGlofOrderCancel" parameterMap="updateparameterMap" >
		UPDATE ORDER_GLOF 
        <dynamic prepend="set">
		   <isNotEmpty prepend="," property="sts">
              STS=#sts#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateUser">
              UPDATE_USER=#updateUser#
           </isNotEmpty>
           <isNotEmpty prepend="," property="updateTime">
              UPDATE_TIME=#updateTime#
           </isNotEmpty>
        </dynamic>
		WHERE      ID=#id#
	</update>
	
	<parameterMap class="java.util.HashMap" id="insertParameterMap">   
      <parameter   property="confirmTime" />
		<parameter   property="sts" />
		<parameter   property="totalBall" />
		<parameter  property="price" />
		<parameter   property="additionalFee" />
		<parameter   property="amountPrice" />
		<parameter   property="paySts" />
		<parameter   property="consumerSts" />
		<parameter   property="operateSts" />
		<parameter   property="createUser" />
		<parameter   property="createTime" />
		<parameter   property="updateUser" />
		<parameter   property="updateTime" />
		<parameter   property="id" />
		<parameter   property="siteId" />
		<parameter   property="memberCode" />
		<parameter   property="count" />
		<parameter   property="bookTime" />
		<parameter   property="source" />
		<parameter   property="rmk" />
		<parameter   property="profit" />
		<parameter   property="profitAmount" />
		<parameter   property="signPrice" />
    </parameterMap>
	
	<insert id="api_saveGolfOrder" parameterMap="insertParameterMap">
		INSERT INTO ORDER_GLOF
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="siteId">SITE_ID</isNotEmpty>
			<isNotEmpty prepend="," property="id">ID</isNotEmpty>
			<isNotEmpty prepend="," property="memberCode">MEMBER_CODE</isNotEmpty>
			<isNotEmpty prepend="," property="count">COUNT</isNotEmpty>
			<isNotEmpty prepend="," property="bookTime">BOOK_TIME</isNotEmpty>
			<isNotEmpty prepend="," property="confirmTime">CONFIRM_TIME</isNotEmpty>
			<isNotEmpty prepend="," property="sts">STS</isNotEmpty>
			<isNotEmpty prepend="," property="totalBall">TOTAL_BALL</isNotEmpty>
			<isNotEmpty prepend="," property="price">PRICE</isNotEmpty>
			<isNotEmpty prepend="," property="additionalFee">ADDITIONAL_FEE</isNotEmpty>
			<isNotEmpty prepend="," property="amountPrice">AMOUNT_PRICE</isNotEmpty>
			<isNotEmpty prepend="," property="paySts">PAY_STS</isNotEmpty>
			<isNotEmpty prepend="," property="consumerSts">CONSUMER_STS</isNotEmpty>
			<isNotEmpty prepend="," property="source">SOURCE</isNotEmpty>
			<isNotEmpty prepend="," property="rmk">RMK</isNotEmpty>
			<isNotEmpty prepend="," property="code">CODE</isNotEmpty>
			<isNotEmpty prepend="," property="profit">PROFIT</isNotEmpty>
			<isNotEmpty prepend="," property="profitAmount">PROFIT_AMOUNT</isNotEmpty>
			<isNotEmpty prepend="," property="signPrice">SIGNING_PRICE</isNotEmpty>
			<isNotEmpty prepend="," property="operateSts">OPERATE_STS</isNotEmpty>
			<isNotEmpty prepend="," property="createUser">CREATE_USER</isNotEmpty>
			<isNotEmpty prepend="," property="createTime">CREATE_TIME</isNotEmpty>
			<isNotEmpty prepend="," property="updateUser">UPDATE_USER</isNotEmpty>
			<isNotEmpty prepend="," property="updateTime">UPDATE_TIME</isNotEmpty>
		</dynamic>		
		<dynamic prepend=") VALUES (">
			<isNotEmpty prepend="," property="siteId">#siteId#</isNotEmpty>
			<isNotEmpty prepend="," property="id">#id#</isNotEmpty>
			<isNotEmpty prepend="," property="memberCode">#memberCode#</isNotEmpty>
			<isNotEmpty prepend="," property="count">#count#</isNotEmpty>
			<isNotEmpty prepend="," property="bookTime">#bookTime#</isNotEmpty>
			<isNotEmpty prepend="," property="confirmTime">#confirmTime#</isNotEmpty>
			<isNotEmpty prepend="," property="sts">#sts#</isNotEmpty>
			<isNotEmpty prepend="," property="totalBall">#totalBall#</isNotEmpty>
			<isNotEmpty prepend="," property="price">#price#</isNotEmpty>
			<isNotEmpty prepend="," property="additionalFee">#additionalFee#</isNotEmpty>
			<isNotEmpty prepend="," property="amountPrice">#amountPrice#</isNotEmpty>
			<isNotEmpty prepend="," property="paySts">#paySts#</isNotEmpty>
			<isNotEmpty prepend="," property="consumerSts">#consumerSts#</isNotEmpty>
			<isNotEmpty prepend="," property="source">#source#</isNotEmpty>
			<isNotEmpty prepend="," property="rmk">#rmk#</isNotEmpty>
			<isNotEmpty prepend="," property="code">#code#</isNotEmpty>
			<isNotEmpty prepend="," property="profit">#profit#</isNotEmpty>
			<isNotEmpty prepend="," property="profitAmount">#profitAmount#</isNotEmpty>
			<isNotEmpty prepend="," property="signPrice">#signPrice#</isNotEmpty>
			<isNotEmpty prepend="," property="operateSts">#operateSts#</isNotEmpty>
			<isNotEmpty prepend="," property="createUser">#createUser#</isNotEmpty>
			<isNotEmpty prepend="," property="createTime">#createTime#</isNotEmpty>
			<isNotEmpty prepend="," property="updateUser">#updateUser#</isNotEmpty>
			<isNotEmpty prepend="," property="updateTime">#updateTime#</isNotEmpty>
		 </dynamic>	)
	</insert>

<update id="updateGolfOrderVo" parameterClass="golfOrderVo">
		UPDATE ORDER_GLOF
        <dynamic prepend="set">
         <isNotEmpty prepend="," property="rmk">
              RMK=#rmk#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="confirmTime">
              CONFIRM_TIME=#confirmTime#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="sts">
              STS=#sts#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="totalBall">
              TOTAL_BALL=#totalBall#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="price">
              PRICE=#price#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="additionalFee">
              ADDITIONAL_FEE=#additionalFee#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="amountPrice">
              AMOUNT_PRICE=#amountPrice#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="paySts">
              PAY_STS=#paySts#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="consumerSts">
              CONSUMER_STS=#consumerSts#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="operateSts">
              OPERATE_STS=#operateSts#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="createUser">
              CREATE_USER=#createUser#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="createTime">
              CREATE_TIME=#createTime#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="updateUser">
              UPDATE_USER=#updateUser#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="updateTime">
              UPDATE_TIME=#updateTime#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="siteId">
              SITE_ID=#siteId#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="memberCode">
              MEMBER_CODE=#memberCode#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="count">
              COUNT=#count#
           </isNotEmpty>
		   <isNotEmpty prepend="," property="bookTime">
              BOOK_TIME=#bookTime#
           </isNotEmpty>
           
           <isNotEmpty prepend="," property="source">
              SOURCE=#source#
           </isNotEmpty>
           <isNotEmpty prepend="," property="code">
              CODE=#code#
           </isNotEmpty>
           <isNotEmpty prepend="," property="profit">
              PROFIT=#profit#
           </isNotEmpty>
           <isNotEmpty prepend="," property="profitAmount">
              PROFIT_AMOUNT=#profitAmount#
           </isNotEmpty>
           <isNotEmpty prepend="," property="signPrice">
              SIGNING_PRICE=#signPrice#
           </isNotEmpty>
           
        </dynamic>
		WHERE 
               ID=#id#
	</update>

</sqlMap>